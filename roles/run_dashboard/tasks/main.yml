- name: Copy template files
  template:
    src: '{{ item }}'
    dest: '{{ docker_compose_dir }}/dashboard/{{ item }}'
    mode: 0600
  loop:
    - docker-compose.yml
  register: compose_config

# se remueve el siguiente paso porque en dev local se compila manual y en test (o dev en el cliente)
# es necesario hacer el pull desde conatelid docker repo porque el build no es posible
# This image is build for development
# - name: Build the development dashboard image
#   docker_image:
#     build:
#       path: '{{ dashboard_folder }}'
#       pull: no
#       dockerfile: 'Dockerfile.dev'
#     name: '{{ project_name }}-dashboard-dev:{{ version }}'
#     source: build
#     push: no
#   when: env == 'dev'

- name: Start the containers
  docker_compose:
    project_src: '{{ docker_compose_dir }}/dashboard'
    restarted: '{{ compose_config is changed }}'
    build: no
    state: present